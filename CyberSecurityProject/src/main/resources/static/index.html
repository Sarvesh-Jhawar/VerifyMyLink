<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URL Safety Checker</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap');

        :root {
          --primary-color: #007bff;
          --primary-hover: #0056b3;
          --success-color: #28a745;
          --danger-color: #dc3545;
          --warning-color: #ffc107;
          --light-color: #f8f9fa;
          --dark-color: #343a40;
          --background-color: #f4f7f6;
          --border-color: #dee2e6;
          --box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        body {
          font-family: 'Poppins', sans-serif;
          background-color: var(--background-color);
          display: flex;
          justify-content: center;
          align-items: center;
          min-height: 100vh;
          margin: 0;
        }

        .container {
          background: #fff;
          padding: 2rem;
          border-radius: 15px;
          box-shadow: var(--box-shadow);
          max-width: 600px;
          width: 100%;
          text-align: center;
        }

        h2 {
          margin-bottom: 1rem;
          color: var(--dark-color);
        }

        .url-form {
          display: flex;
          gap: 0.5rem;
          margin-bottom: 1rem;
        }

        #urlInput {
          flex-grow: 1;
          padding: 0.75rem 1rem;
          border: 1px solid var(--border-color);
          border-radius: 8px;
          font-size: 1rem;
        }

        button {
          padding: 0.75rem 1.5rem;
          background: var(--primary-color);
          color: #fff;
          border: none;
          border-radius: 8px;
          cursor: pointer;
        }

        button:hover {
          background: var(--primary-hover);
        }

        .loader {
          border: 4px solid var(--light-color);
          border-top: 4px solid var(--primary-color);
          border-radius: 50%;
          width: 40px;
          height: 40px;
          animation: spin 1s linear infinite;
          margin: 1rem auto;
          display: none;
        }

        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }

        .result-box {
          margin-top: 1rem;
          padding: 1rem;
          border-radius: 8px;
          display: none;
          text-align: left;
          white-space: pre-line;
        }

        .safe { border: 1px solid rgba(40,167,69,.2); background: rgba(40,167,69,.1); color: var(--success-color); }
        .unsafe { border: 1px solid rgba(227, 43, 62, 0.2); background: rgba(211, 46, 62, 0.1); color: var(--danger-color); }
        .error { border: 1px solid rgba(255,193,7,.2); background: rgba(255,193,7,.1); color: var(--warning-color); }
    </style>
</head>
<body>
<main class="container">
    <h2>üîí URL Safety Checker</h2>

    <form id="urlForm" class="url-form">
        <input type="url" id="urlInput" placeholder="Enter a URL (e.g., https://example.com)" required>
        <button type="submit">Check</button>
    </form>

    <div id="loader" class="loader"></div>

    <!-- Separate result boxes -->
    <div id="vtResult" class="result-box"></div>
    <div id="googleResult" class="result-box"></div>
</main>

<script>
    const urlForm = document.getElementById("urlForm");
    const urlInput = document.getElementById("urlInput");
    const loader = document.getElementById("loader");
    const vtResultEl = document.getElementById("vtResult");
    const googleResultEl = document.getElementById("googleResult");

    urlForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const url = urlInput.value.trim();
      if (!url) return;

      vtResultEl.style.display = "none";
      googleResultEl.style.display = "none";
      loader.style.display = "block";

      const formData = new URLSearchParams();
      formData.append("url", url);

      try {
        const response = await fetch("http://localhost:8081/check", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: formData
        });

        if (!response.ok) throw new Error("HTTP error " + response.status);

        const resultJson = await response.json();

        showResult(vtResultEl, "VirusTotal ‚Üí " + resultJson.virusTotal);
        showResult(googleResultEl, "Google Safe Browsing ‚Üí " + resultJson.googleSafeBrowsing);

      } catch (err) {
        showResult(vtResultEl, `‚ùå Error: ${err.message}`, "error");
        googleResultEl.style.display = "none"; // Hide the other box on error
      } finally {
        loader.style.display = "none";
      }
    });

    function showResult(element, message, statusType = null) {
      element.innerText = message;
      element.style.display = "block";

      const lower = message.toLowerCase();
      // Default to 'error' (yellow/warning) for statuses that aren't explicitly safe or unsafe.
      let type = 'error';

      if (statusType) { // If a type is forced (e.g., for network errors)
        type = statusType;
      } else if (lower.includes("safe") || lower.includes("harmless") || lower.includes("clean")) {
        type = "safe";
      } else if (lower.includes("unsafe") || lower.includes("malicious") || lower.includes("suspicious") || lower.includes("phishing") || lower.includes("malware") || lower.includes("‚ö†Ô∏è")) {
        type = "unsafe";
      }

      element.className = `result-box ${type}`;
    }
</script>
</body>
</html>
